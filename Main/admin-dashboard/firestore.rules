rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isAdmin() {
      return request.auth != null
        && request.auth.token.email == 'mytemporarygeneratedid2@gmail.com';
    }

    // Minimal validation WITHOUT type checks (Firestore Rules doesn't support "is string")
    function isValidLead(lead) {
      return lead.keys().hasAll(['name','email','phone','service','siteLocation','budget','message'])
        && lead.name.size() > 0 && lead.name.size() <= 100
        && lead.email.size() > 0 && lead.email.size() <= 150
        && lead.phone.size() > 0 && lead.phone.size() <= 50
        && lead.service.size() > 0 && lead.service.size() <= 100
        && lead.siteLocation.size() > 0 && lead.siteLocation.size() <= 200
        && lead.budget.size() > 0 && lead.budget.size() <= 50
        && lead.message.size() > 0 && lead.message.size() <= 2000;
    }

    match /leads/{leadId} {
      allow create: if isValidLead(request.resource.data);
      allow read, update, delete: if isAdmin();
    }

    match /settings/{settingId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    match /{document=**} {
      allow read, write: if false;
    }
  }
}
